<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Checker - Debug Console</title>

    <!-- Favicon -->
    <link rel="icon" type="image/webp" href="assets/images/logo.webp">
    <link rel="apple-touch-icon" href="assets/images/logo.webp">

    <style>
        body {
            font-family: monospace;
            background: #1e293b;
            color: #e2e8f0;
            margin: 0;
            padding: 20px;
        }
        #console {
            border: 1px solid #64748b;
            border-radius: 8px;
            padding: 15px;
            background: #0f172a;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .log { color: #e2e8f0; padding: 5px 0; }
        .error { color: #ef4444; padding: 5px 0; font-weight: bold; }
        .warn { color: #f59e0b; padding: 5px 0; }
        .success { color: #10b981; padding: 5px 0; }
        .info { color: #3b82f6; padding: 5px 0; }
        #status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .status-box {
            border: 1px solid #64748b;
            border-radius: 8px;
            padding: 15px;
            background: #1e293b;
        }
        .status-box h3 { margin: 0 0 10px 0; }
        .status-value { font-size: 14px; }
        button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
        }
        button:hover { background: #2563eb; }
    </style>
</head>
<body>
    <h1>üîß Email Checker - Debug Console</h1>

    <div id="console" class="info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div>
        <button onclick="loadMainApp()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <button onclick="testAPI()">–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API</button>
        <button onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <div id="status">
        <div class="status-box">
            <h3>üìã –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤</h3>
            <div class="status-value">
                store: <span id="store-status">‚ùì</span><br>
                themeManager: <span id="theme-status">‚ùì</span><br>
                router: <span id="router-status">‚ùì</span><br>
                api: <span id="api-status">‚ùì</span><br>
                toast: <span id="toast-status">‚ùì</span>
            </div>
        </div>
    </div>

    <script>
        const consoleOutput = document.getElementById('console');

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addLog(type, message) {
            const line = document.createElement('div');
            line.className = type;
            const now = new Date().toLocaleTimeString();
            line.textContent = `[${now}] ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog(...args);
            addLog('log', args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '));
        };

        console.error = function(...args) {
            originalError(...args);
            addLog('error', '‚ùå ' + args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '));
        };

        console.warn = function(...args) {
            originalWarn(...args);
            addLog('warn', '‚ö†Ô∏è ' + args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '));
        };

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
        window.addEventListener('error', (event) => {
            addLog('error', `Uncaught Error: ${event.message} at ${event.filename}:${event.lineno}`);
        });

        window.addEventListener('unhandledrejection', (event) => {
            addLog('error', `Unhandled Promise Rejection: ${event.reason}`);
        });

        function checkScripts() {
            addLog('info', 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤...');

            const checks = {
                'store-status': typeof window.store !== 'undefined' ? '‚úÖ' : '‚ùå',
                'theme-status': typeof window.themeManager !== 'undefined' ? '‚úÖ' : '‚ùå',
                'router-status': typeof window.router !== 'undefined' ? '‚úÖ' : '‚ùå',
                'api-status': typeof window.api !== 'undefined' ? '‚úÖ' : '‚ùå',
                'toast-status': typeof window.toast !== 'undefined' ? '‚úÖ' : '‚ùå',
            };

            for (const [id, status] of Object.entries(checks)) {
                document.getElementById(id).textContent = status;
            }

            if (Object.values(checks).every(s => s === '‚úÖ')) {
                addLog('success', '‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
            } else {
                addLog('warn', '‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }
        }

        function loadMainApp() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
            if (typeof window.store !== 'undefined' && typeof window.api !== 'undefined') {
                addLog('info', 'üì¶ –°–∫—Ä–∏–ø—Ç—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ...');
                checkScripts();
                return;
            }

            addLog('info', 'üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            const scripts = [
                'assets/js/utils/state.js',
                'assets/js/utils/theme.js',
                'assets/js/utils/router.js',
                'assets/js/services/api.js',
                'assets/js/services/websocket.js',
                'assets/js/components/toast.js',
                'assets/js/components/modal.js',
                'assets/js/components/table.js',
                'assets/js/components/lazy-loader.js',
                'assets/js/components/performance-monitor.js',
                'assets/js/components/navbar-init.js',
                'assets/js/components/sidebar-init.js',
                'assets/js/components/dashboard.js',
                'assets/js/components/lists-manager.js',
                'assets/js/main.js'
            ];

            let loaded = 0;
            scripts.forEach(src => {
                const script = document.createElement('script');
                script.src = src + '?t=' + Date.now(); // Cache busting
                script.onload = () => {
                    loaded++;
                    addLog('success', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω: ${src}`);
                    if (loaded === scripts.length) {
                        addLog('success', '‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                        checkScripts();
                    }
                };
                script.onerror = () => {
                    addLog('error', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${src}`);
                };
                document.head.appendChild(script);
            });
        }

        function testAPI() {
            addLog('info', 'üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            fetch('/api/lists')
                .then(r => r.json())
                .then(data => {
                    addLog('success', '‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: ' + JSON.stringify(data).substring(0, 100));
                })
                .catch(e => {
                    addLog('error', `‚ùå API –æ—à–∏–±–∫–∞: ${e.message}`);
                });
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        addLog('info', 'üöÄ Debug Console –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        checkScripts();
    </script>
</body>
</html>
